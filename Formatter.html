
<!-- saved from url=(0057)https://www-personal.umich.edu/~hmrazali/grade-formatter/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Formatter</title>
    <link href="./Formatter_files/bootstrap.css" rel="stylesheet">
    <style type="text/css">
        /*help*/
        html, body {
            height: 100%;
        }

        .content {
            height: calc(100% - 130px);
        }

        .header {
            height: 130px;
            background-color: rgb(0, 42, 84);
        }

        .header .header-content {
            position: relative;
            text-align: center;
        }

        .header-image {
            position: absolute;
            top: 10px;
        }

        .header .header-image > img {
            width: 100px;
            vertical-align: middle;
        }

        .header .header-text {
            color: white;
            font-size: 45px;
            font-weight: 100;
            height: 130px;
            line-height: 130px;
        }

        .content {
            padding-top: 50px;
        }

        .content .file-input {
            height: calc(100% - 50px);
            padding-top: 10%;
            border: 3px dashed #f1f1f1;
        }

        .content .file-input label {
            font-weight: 200;
        }

        .drop-file-instruct {
            font-size: 65px;
            color: rgb(230, 230, 230);
            font-weight: 200;
            pointer-events: none;
        }

        .drop-file-or {
            margin-bottom: 10px;
            color: rgb(190, 190, 190);
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="row header">
        <div class="col-md-8 col-md-offset-2">
            <div class="row header-content">
                <div class="header-image">
                    <img src="./Formatter_files/2color-transparentbg.png">
                </div>
                <div class="header-text">
                    Grade Export Formatter
                </div>
            </div>
        </div>
    </div>
    <div class="row content">
        <div class="col-md-8 col-md-offset-2 file-input" id="drop_zone">
            <div class="text-center drop-file-instruct">
                Drag file here
            </div>
            <div class="text-center drop-file-or">
                or
            </div>
            <div class="text-center">
                <label class="btn btn-primary" for="csv-file">
                    <input id="csv-file" type="file" name="files" style="display:none;">
                    Choose CSV Grade File
                </label>
            </div>
            <div class="text-center">
                <span id="upload-file-info"></span>
            </div>
        </div>
    </div>

<script type="text/javascript" src="./Formatter_files/papaparse.js"></script>
<script type="text/javascript" src="./Formatter_files/jquery.js"></script>
<script>
    (function() {
        var targetColumns = ['SIS Login ID', 'Final Grade'];

        function handleFileSelect(evt) {
            var file;
            if (evt.type === 'drop') {
                file = evt.dataTransfer.files[0];
                evt.stopPropagation();
                evt.preventDefault();
            } else {
                file = evt.target.files[0];
            }

            Papa.parse(file, {
                header: true,
                dynamicTyping: true,
                complete: function(results) {
                    var targetData = results.data.slice(1); // ignore first row
                    formattedData = formatData(targetData, targetColumns);
                    downloadCSVFile(formattedData);
                    console.log('formattedData', formattedData)
                }
            });

            $('#upload-file-info').html(file.name);
        }

        function formatData(data, targetCols) {
            return data.map(function(row) {
                return targetCols.map(function(col) {
                    return row[col];
                });
            });
        }

        function downloadCSVFile(data) {
            // credit: http://stackoverflow.com/questions/14964035/how-to-export-javascript-array-info-to-csv-on-client-side
            var csvContent = "data:text/csv;charset=utf-8,";
            data.forEach(function(infoArray, index){
               dataString = infoArray.join(",");
               csvContent += index < data.length ? dataString + "\n" : dataString;
            });
            var encodedUri = encodeURI(csvContent);
            var link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "formatted-student-grades.csv");
            document.body.appendChild(link); // Required for FF
            link.click(); // This will download the data file named "my_data.csv".
        }

        function handleDragOver(evt) {
            evt.stopPropagation();
            evt.preventDefault();
            evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
        }

        $(document).ready(function(){
            // credit: https://www.html5rocks.com/en/tutorials/file/dndfiles/
            var dropZone = document.getElementById('drop_zone');
            dropZone.addEventListener('dragover', handleDragOver, false);
            dropZone.addEventListener('drop', handleFileSelect, false);
            $("#csv-file").on('change', handleFileSelect);
        });
    })();

</script>

</body></html>